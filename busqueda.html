<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Resultados de b√∫squeda - Ayuntamiento de Pioz">
    <title>B√∫squeda | Ayuntamiento de Pioz</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    <style>
        .busqueda-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .search-header {
            background: var(--card-bg);
            padding: var(--spacing-xl);
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-xl);
        }
        
        .search-form-main {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .search-input-main {
            flex: 1;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            font-size: var(--font-size-large);
            background: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .search-input-main:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        
        .btn-search {
            padding: var(--spacing-md) var(--spacing-xl);
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .btn-search:hover {
            background: var(--color-teja-rojo);
            transform: translateY(-2px);
        }
        
        .search-query {
            color: var(--text-secondary);
            font-size: var(--font-size-small);
        }
        
        .search-query strong {
            color: var(--color-primary);
            font-size: var(--font-size-large);
        }
        
        .search-suggestion {
            background: #fff3cd;
            padding: var(--spacing-md);
            border-left: 4px solid #ffc107;
            border-radius: 4px;
            margin-bottom: var(--spacing-lg);
        }
        
        [data-theme="dark"] .search-suggestion {
            background: #3a3320;
        }
        
        .search-suggestion p {
            margin: 0;
            color: var(--text-primary);
        }
        
        .search-suggestion a {
            color: #856404;
            font-weight: 600;
            text-decoration: underline;
            cursor: pointer;
        }
        
        [data-theme="dark"] .search-suggestion a {
            color: #ffc107;
        }
        
        .search-results {
            margin-bottom: var(--spacing-xl);
        }
        
        .results-count {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-small);
        }
        
        .result-item {
            background: var(--card-bg);
            padding: var(--spacing-xl);
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--spacing-lg);
            transition: all var(--transition-base);
            border-left: 4px solid var(--color-primary);
        }
        
        .result-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateX(5px);
        }
        
        .result-category {
            display: inline-block;
            background: var(--color-primary);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 4px;
            font-size: var(--font-size-small);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }
        
        .result-title {
            margin: 0 0 var(--spacing-sm) 0;
        }
        
        .result-title a {
            color: var(--color-primary);
            text-decoration: none;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .result-title a:hover {
            text-decoration: underline;
        }
        
        .result-snippet {
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
        }
        
        .result-snippet mark {
            background: #ffc107;
            color: #000;
            padding: 2px 4px;
            border-radius: 2px;
            font-weight: 600;
        }
        
        .result-meta {
            display: flex;
            gap: var(--spacing-md);
            font-size: var(--font-size-small);
            color: var(--text-secondary);
        }
        
        .result-meta span {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        
        .no-results {
            background: var(--card-bg);
            padding: var(--spacing-xl);
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }
        
        .no-results-icon {
            font-size: 5rem;
            display: block;
            margin-bottom: var(--spacing-lg);
        }
        
        .no-results h2 {
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
        }
        
        .no-results p {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
        }
        
        .suggestions-list {
            list-style: none;
            padding: 0;
            margin: var(--spacing-lg) 0;
        }
        
        .suggestions-list li {
            padding: var(--spacing-xs) 0;
        }
        
        .suggestions-list li::before {
            content: '‚Ä¢';
            color: var(--color-primary);
            font-weight: bold;
            margin-right: var(--spacing-xs);
        }
        
        @media (max-width: 767px) {
            .search-form-main {
                flex-direction: column;
            }
            
            .result-meta {
                flex-direction: column;
                gap: var(--spacing-xs);
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <main id="main-content">
        <section class="page-header">
            <div class="container">
                <nav aria-label="Breadcrumb">
                    <ol class="breadcrumb" style="list-style: none; display: flex; gap: 0.5rem; padding: 0;">
                        <li><a href="index.html">Inicio</a></li>
                        <li>&raquo;</li>
                        <li aria-current="page">Resultados de b√∫squeda</li>
                    </ol>
                </nav>
            </div>
        </section>

        <section class="content-section">
            <div class="container busqueda-container">
                <!-- Cabecera de b√∫squeda -->
                <div class="search-header">
                    <form class="search-form-main" onsubmit="return performSearch()">
                        <input 
                            type="search" 
                            id="searchInputMain" 
                            class="search-input-main" 
                            placeholder="¬øQu√© est√°s buscando?"
                            autocomplete="off"
                            required
                        >
                        <button type="submit" class="btn-search">
                            üîç Buscar
                        </button>
                    </form>
                    <p class="search-query">
                        Has buscado: <strong id="currentQuery"></strong>
                    </p>
                </div>

                <!-- Sugerencia ortogr√°fica -->
                <div id="suggestionBox" class="search-suggestion" style="display: none;">
                    <p>
                        ¬øQuiz√°s quisiste decir: <a id="suggestionLink"></a>?
                    </p>
                </div>

                <!-- Resultados -->
                <div class="search-results">
                    <p class="results-count" id="resultsCount"></p>
                    <div id="resultsContainer"></div>
                </div>

                <!-- Sin resultados -->
                <div id="noResults" class="no-results" style="display: none;">
                    <span class="no-results-icon">üîç</span>
                    <h2>No se encontraron resultados</h2>
                    <p>No hemos encontrado ning√∫n resultado para tu b√∫squeda.</p>
                    <p><strong>Sugerencias:</strong></p>
                    <ul class="suggestions-list">
                        <li>Comprueba que todas las palabras est√©n escritas correctamente</li>
                        <li>Intenta usar palabras clave diferentes</li>
                        <li>Intenta usar palabras clave m√°s generales</li>
                        <li>Prueba con sin√≥nimos o t√©rminos relacionados</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Component -->
    <div id="footer-placeholder"></div>

    <script src="components/header.js"></script>
    <script src="components/footer.js"></script>
    <script src="js/theme-toggle.js"></script>
    <script src="js/search-engine.js"></script>
    <script src="js/navigation.js"></script>
    <script>
        // Ejecutar b√∫squeda al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            const query = sessionStorage.getItem('searchQuery');
            if (query) {
                document.getElementById('searchInputMain').value = query;
                executeSearch(query);
            } else {
                // Si no hay query, redirigir a inicio
                window.location.href = 'index.html';
            }
        });

        // Funci√≥n para ejecutar la b√∫squeda
        function executeSearch(query) {
            const currentQueryEl = document.getElementById('currentQuery');
            const resultsCountEl = document.getElementById('resultsCount');
            const resultsContainerEl = document.getElementById('resultsContainer');
            const noResultsEl = document.getElementById('noResults');
            const suggestionBoxEl = document.getElementById('suggestionBox');
            const suggestionLinkEl = document.getElementById('suggestionLink');

            // Mostrar consulta actual
            currentQueryEl.textContent = query;

            // Realizar b√∫squeda
            const { results, suggestion } = window.SearchEngine.search(query);

            // Ocultar elementos por defecto
            noResultsEl.style.display = 'none';
            suggestionBoxEl.style.display = 'none';
            resultsContainerEl.innerHTML = '';

            if (results.length > 0) {
                // Mostrar contador de resultados
                resultsCountEl.textContent = `${results.length} resultado${results.length !== 1 ? 's' : ''} encontrado${results.length !== 1 ? 's' : ''}`;

                // Renderizar resultados
                results.forEach(result => {
                    const resultEl = document.createElement('div');
                    resultEl.className = 'result-item';

                    const categoryColor = getCategoryColor(result.category);
                    
                    resultEl.innerHTML = `
                        <span class="result-category" style="background: ${categoryColor};">${result.category}</span>
                        <h3 class="result-title">
                            <a href="${result.url}">${window.SearchEngine.highlightText(result.title, query)}</a>
                        </h3>
                        <p class="result-snippet">${window.SearchEngine.highlightText(result.snippet, query)}</p>
                        <div class="result-meta">
                            <span>üìÖ ${formatDate(result.date)}</span>
                            <span>üìÇ ${result.type}</span>
                            <span>‚≠ê Relevancia: ${Math.round(result.relevance)}</span>
                        </div>
                    `;

                    resultsContainerEl.appendChild(resultEl);
                });
            } else {
                // Sin resultados
                resultsCountEl.textContent = '0 resultados encontrados';
                noResultsEl.style.display = 'block';

                // Mostrar sugerencia ortogr√°fica si existe
                if (suggestion) {
                    suggestionBoxEl.style.display = 'block';
                    suggestionLinkEl.textContent = suggestion;
                    suggestionLinkEl.onclick = function() {
                        document.getElementById('searchInputMain').value = suggestion;
                        executeSearch(suggestion);
                        sessionStorage.setItem('searchQuery', suggestion);
                    };
                }
            }
        }

        // Funci√≥n para realizar nueva b√∫squeda
        function performSearch() {
            const query = document.getElementById('searchInputMain').value.trim();
            if (query.length >= 2) {
                sessionStorage.setItem('searchQuery', query);
                executeSearch(query);
            }
            return false;
        }

        // Funci√≥n para obtener color seg√∫n categor√≠a
        function getCategoryColor(category) {
            const colors = {
                'Bandos': '#e74c3c',
                'Tr√°mites': '#3498db',
                'Ayuntamiento': '#2c3e50',
                'Cultura': '#9b59b6',
                'Servicios': '#16a085',
                'Villa': '#c0392b',
                'Plenos': '#34495e'
            };
            return colors[category] || '#95a5a6';
        }

        // Funci√≥n para formatear fecha
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('es-ES', options);
        }
    </script>
</body>
</html>